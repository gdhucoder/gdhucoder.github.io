<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Singleton Pattern - CoderPunk</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Singleton Pattern" />
<meta property="og:description" content="[TOC]
Brief introduction about Singleton Pattern" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gdhucoder.github.io/post/designpattern/021_singletonpattern/" />
<meta property="article:published_time" content="2020-01-04T10:22:03+08:00" />
<meta property="article:modified_time" content="2020-01-04T10:22:03+08:00" />

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="CoderPunk" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">CoderPunk</div>
					<div class="logo__tagline">A Programmer&#39;s self-cultivation</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/post">
				
				<span class="menu__text">æŠ€æœ¯æ–‡ç« </span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/reading">
				
				<span class="menu__text">è¯»ä¹¦</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/thinking">
				
				<span class="menu__text">æ€è€ƒ</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about">
				
				<span class="menu__text">å…³äºæˆ‘</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://github.com/gdhucoder">
				
				<span class="menu__text">ToMyGit</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Singleton Pattern</h1>
			
		</header><div class="content post__content clearfix">
			<p>[TOC]</p>
<p>Brief introduction about Singleton Pattern</p>
<h1 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</h1>
<h2 id="å®šä¹‰">å®šä¹‰</h2>
<p>å•ä¾‹æ¨¡å¼è®¨è®ºçš„æ˜¯ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹çš„æƒ…å†µã€‚
åœ¨Javaä¸­è¦è®¨è®ºçš„æ˜¯åœ¨æ¯ä¸ªJVMï¼ˆjavaè™šæ‹Ÿæœºï¼‰ä¸­ï¼Œä»…æœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>æ³¨æ„ä¸¤ä¸ªè¯ï¼š<strong>æ¯ä¸ªJVM</strong>ï¼Œ<strong>ä¸€ä¸ªå®ä¾‹</strong>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹åœ¨Javaä¸­å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ã€‚</p>
<p>ä»£ç é‡æ¯”è¾ƒå¤šã€‚<a href="./code/u021">code example</a></p>
<h2 id="é¥¿æ±‰æ¨¡å¼eager-initialization">é¥¿æ±‰æ¨¡å¼ï¼ˆEager Initializationï¼‰</h2>
<p>ä¸ç®¡æœ‰æ²¡æœ‰å…¶ä»–ç±»è°ƒç”¨è¿™ä¸ªå®ä¾‹ï¼Œå•ä¾‹åœ¨ç³»ç»Ÿç±»åŠ è½½æ—¶å°±ä¼šè¢«åˆ›å»ºã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EagerSingleton</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> EagerSingleton instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> EagerSingleton<span style="color:#f92672">();</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> EagerSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> instance<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">EagerSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">printf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s Instance Created!\n&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>è¿™ç§æ–¹æ³•ä»…æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹è±¡å¤§æ—¶ï¼Œå ç”¨ç³»ç»Ÿèµ„æºè¾ƒå¤šã€‚
å¦‚æœå¯¹è±¡ä¸å¤§ï¼Œå ç”¨ç³»ç»Ÿèµ„æºè¾ƒå°‘ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°å•ä¾‹çš„å¥½æ–¹æ³•ã€‚</p>
<h2 id="æ‡’æ±‰æ¨¡å¼lazy-initialization">æ‡’æ±‰æ¨¡å¼ï¼ˆLazy Initializationï¼‰</h2>
<p>åœ¨ç¼–ç¨‹ä¸­ï¼Œå»¶è¿Ÿåˆå§‹åŒ–æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§ã€‚åœ¨ç¬¬ä¸€æ¬¡éœ€è¦æ—¶ï¼Œæ‰åˆ›å»ºå¯¹è±¡ã€è®¡ç®—å€¼æˆ–è€…æ‰§è¡Œå…¶ä»–è€—æ—¶çš„è¿‡ç¨‹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LazySingleton</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> LazySingleton instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">LazySingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> LazySingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>instance <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
      <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>LazySingleton<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">){</span>
        instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LazySingleton<span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> instance<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Double Check:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> LazySingletonV2 <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>instance <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>LazySingletonV2<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>instance <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
          instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LazySingletonV2<span style="color:#f92672">();</span>
          <span style="color:#75715e">// multi thread will generate two or more instances.
</span><span style="color:#75715e"></span>          System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;instance address: &#34;</span> <span style="color:#f92672">+</span> instance<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> instance<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
</code></pre></div><h2 id="é™æ€å—åˆå§‹åŒ–-singleton-with-static-block-initialization">é™æ€å—åˆå§‹åŒ– Singleton with static block initialization</h2>
<p>è¿™ç§æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™åˆ›å»ºå®ä¾‹ã€‚æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šå°±æ˜¯å‡è®¾è¿™ä¸ªç±»é‡Œæœ‰5ä¸ªé™æ€å˜é‡ï¼Œä»£ç ä»…éœ€è¦è®¿é—®2-3ä¸ªå˜é‡ï¼Œè¿™æ—¶åˆ›å»º
instanceå°±æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StaticBlockSingleton</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> StaticBlockSingleton instance<span style="color:#f92672">;</span>

  <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
    instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StaticBlockSingleton<span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">StaticBlockSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> StaticBlockSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> instance<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><h2 id="bill-pugh-å•ä¾‹">Bill Pugh å•ä¾‹</h2>
<p>LazyHolderç±»åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºã€‚åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥è®¿é—®å…¶ä»–é™æ€å˜é‡ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BillPughSingleton</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> NUM <span style="color:#f92672">=</span> 10<span style="color:#f92672">;</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">BillPughSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;create singleton.&#34;</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LazyHolder</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
      System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;create class LazyHolder...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> BillPughSingleton instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BillPughSingleton<span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> BillPughSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> LazyHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">instance</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="å•ä¾‹åºåˆ—åŒ–">å•ä¾‹åºåˆ—åŒ–</h2>
<p>ååºåˆ—åŒ–æ—¶ä¼šé‡æ–°ç”Ÿæˆå®ä¾‹ã€‚åœ¨ç±»ä¸­åŠ å…¥<code>readResolve</code>æ–¹æ³•ã€‚è¿”å›å½“å‰å®ä¾‹ã€‚</p>
<blockquote>
<p>This method will be invoked when you will de-serialize the object. Inside of this method, you must return the existing instance to ensure a single instance application wide.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DemoSingleton</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">volatile</span> DemoSingleton instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> DemoSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>instance <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DemoSingleton<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> instance<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 10<span style="color:#f92672">;</span>

  <span style="color:#75715e">// return existing instance.
</span><span style="color:#75715e">//  protected Object readResolve(){
</span><span style="color:#75715e">//    return instance;
</span><span style="color:#75715e">//  }
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getI</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setI</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> i<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="å…³äºåºåˆ—å·">å…³äºåºåˆ—å·</h2>
<p>åºåˆ—åŒ–è¦åŠ ä¸Šåºåˆ—å·ã€‚è‹¥ä¸åŠ ï¼Œè¿™ä¸ªäº†ç±»å¦‚æœä¿®æ”¹çš„è¯ï¼Œå†æ¬¡ååºåˆ—åŒ–æ­¤å‰çš„ç±»ï¼Œä¼šæŠ¥ <code>local class incompatible</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Exception in thread <span style="color:#e6db74">&#34;main&#34;</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">InvalidClassException</span><span style="color:#f92672">:</span> u021<span style="color:#f92672">.</span><span style="color:#a6e22e">seri</span><span style="color:#f92672">.</span><span style="color:#a6e22e">DemoSingleton</span><span style="color:#f92672">;</span> local <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">incompatible</span><span style="color:#f92672">:</span> stream classdesc serialVersionUID <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>6928200329713978600<span style="color:#f92672">,</span> local <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">serialVersionUID</span> <span style="color:#f92672">=</span> 2784835485903072265
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectStreamClass</span><span style="color:#f92672">.</span><span style="color:#a6e22e">initNonProxy</span><span style="color:#f92672">(</span>ObjectStreamClass<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>689<span style="color:#f92672">)</span>
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readNonProxyDesc</span><span style="color:#f92672">(</span>ObjectInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>1903<span style="color:#f92672">)</span>
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readClassDesc</span><span style="color:#f92672">(</span>ObjectInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>1772<span style="color:#f92672">)</span>
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readOrdinaryObject</span><span style="color:#f92672">(</span>ObjectInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>2060<span style="color:#f92672">)</span>
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readObject0</span><span style="color:#f92672">(</span>ObjectInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>1594<span style="color:#f92672">)</span>
	at java<span style="color:#f92672">.</span><span style="color:#a6e22e">base</span><span style="color:#f92672">/</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ObjectInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readObject</span><span style="color:#f92672">(</span>ObjectInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>430<span style="color:#f92672">)</span>
	at u021<span style="color:#f92672">.</span><span style="color:#a6e22e">seri</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Client</span><span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>Client<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>21<span style="color:#f92672">)</span>
</code></pre></div><blockquote>
<p>This problem can be solved only by adding a unique serial version id to the class. It will prevent the compiler from throwing the exception by telling it that both classes are same, and will load the available instance variables only.</p>
</blockquote>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç»è¿‡ä¸Šé¢çš„è®¨è®ºï¼Œé‚£ä¹ˆä¸€ä¸ªæ¨èçš„å•ä¾‹æ¨¡å¼è¯¥å¦‚ä½•å†™å‘¢ï¼Ÿ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DemoSingleton</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> serialVersionUID <span style="color:#f92672">=</span> 1L<span style="color:#f92672">;</span>

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">DemoSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{}</span>

  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DemoSingletonHolder</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> DemoSingleton instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DemoSingleton<span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> DemoSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> DemoSingletonHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">instance</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">protected</span> Object <span style="color:#a6e22e">readResolve</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> getInstance<span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://en.wikipedia.org/wiki/Double-checked_locking">åŒé‡æ£€æŸ¥é”ğŸ”’double-checked_locking</a></p>
<h2 id="é—®é¢˜">é—®é¢˜</h2>
<h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿçš„å•ä¾‹æœ‰å‡ ä¸ª">åˆ†å¸ƒå¼ç³»ç»Ÿçš„å•ä¾‹æœ‰å‡ ä¸ªï¼Ÿ</h3>
<p>Singleton is â€œone instance per JVMâ€, so each node will have its own copy of singleton.</p>
<h3 id="å…³äºbillpughsingleton">å…³äºBillPughSingleton</h3>
<p>ç±»åˆå§‹åŒ–åœ¨JVMå±‚é¢æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BillPughSingleton</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">BillPughSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LazyHolder</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> BillPughSingleton INSTANCE <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BillPughSingleton<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
  
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> BillPughSingleton <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> LazyHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">INSTANCE</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>As per you recommend above code template to design singleton class.
But how Thread safety achieve in above code ??</p>
<p>Itâ€™s already threadsafe because java static field/class
initialization is thread safe â€“ at JVM level.
Static initialization is performed once per class-loader and JVM
ensures the single copy of static fields. So even if two threads access above code,
only one instance of class will be created by JVM.</p>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/designpattern/" rel="tag">DesignPattern</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="HuGuoDong avatar" src="/img/head.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About HuGuoDong</span>
	</div>
	<div class="authorbox__description">
		gdong.hu[at]gmail.com
	</div>
</div>



<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "guodonghu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 CoderPunk.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>